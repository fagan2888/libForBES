<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LibForBES: Optimal control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dox_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LibForBES
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Solver for nonsmooth convex optimization problems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Optimal control </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Optimal control problems</p>
<div class="sec" id="problem-formulation">Problem formulation</div><p>Before we give a code snippet for optimal control problems, we will formulate the problem and we will explain how the forward-backward splitting applies to this class of problems.</p>
<p>Optimal control problems can typically be written as optimization problems over the space of variables </p>
<p class="formulaDsp">
\[ x=(x_0, u_0, x_1, u_1, \ldots, x_{N-1}, u_{N-1}, x_{N}), \]
</p>
<p> with \(x_k\in\mathbb{R}^{n_x}\) and \(u_k\in\mathbb{R}^{n_u}\), \(x\in\mathbb{R}^n\) (where \(n=Nn_x + (N-1)n_u\)) as follows </p>
<p class="formulaDsp">
\[ \mathbb{P}(p): V^\star(p) = \min_x V(x;p), \]
</p>
<p> where \(p\in\mathbb{R}^{n_x}\) is a given parameter, the initial state, and </p>
<p class="formulaDsp">
\[ V(x;p) = \sum_{k=0}^{N-1} \ell(x_k, u_k) + \delta(z|\mathcal{S}(p)) + \ell_N(x_N), \]
</p>
<p>where the <em>stage cost</em> \(\ell:\mathbb{R}^{n_x}\times \mathbb{R}^{n_u} \to (-\infty, \infty]\) is given by</p>
<p class="formulaDsp">
\[ \ell(x_k, u_k) = \phi(x_k, u_k) + \bar{\phi}(Fx_k + Gu_k), \]
</p>
<p>with \(\phi:\mathbb{R}^{n_x}\times \mathbb{R}^{n_u} \to \mathbb{R} \) being a quadratic stage cost</p>
<p class="formulaDsp">
\[ \phi(x_k, u_k) = \frac{1}{2}(x_{k}^{\top}Qx_{k} + u_{k}^{\top}Ru_{k}) + x_k^{\top} S u_k + q^{\top} x_k +r^{\top} u_k, \]
</p>
<p>and \(\bar{\phi}:\mathbb{R}^{n_c}\to (-\infty, \infty]\) is either</p>
<ul>
<li>the indicator of a set (in the case of hard constraints), or</li>
<li>the distance from a set (in the case of soft constraints), or</li>
<li>any other (possibly non-smooth) function for which the proximal operator can be easily computed.</li>
</ul>
<p>Function \(\ell_N:\mathbb{R}^{n_x}\to (-\infty, \infty]\) above is</p>
<p class="formulaDsp">
\[ \ell_N(x_N) = \phi_N(x_N) + \bar\phi(F_N x_N), \]
</p>
<p>with </p>
<p class="formulaDsp">
\[ \phi_N(x_N) = \frac{1}{2}x_N^{\top} Q_N x_N + q_N^{\top} x_N, \]
</p>
<p>and \(\bar\phi_N\) is, similarly to \(\bar\phi\), a nonsmooth function; typically the indicator of a set.</p>
<p>We assume that \(Q\) is a symmetric positive semi-definite matrix, \(R\) and \(Q_N\) are symmetric positive definite.</p>
<p>The set \(\mathcal{S}(p)\subseteq \mathbb{R}^{n}\) encompasses the system dynamics, that is, it is the following affine space:</p>
<p class="formulaDsp">
\[ \mathcal{S}(p) = \left\{ x: x_0 = p, x_{k+1}=Ax_k + Bu_k + f, k=0,\ldots, N-1\right\}. \]
</p>
<p>We define a function \(f:\mathbb{R}^n \to (-\infty, \infty]\) as follows</p>
<p class="formulaDsp">
\[ f(x;p) = \sum_{k=0}^{N-1} \phi(x_k, u_k) + \delta(x| \mathcal{S}(p)) + \phi_N(x_N) \]
</p>
<p>and \(g:\mathbb{R}^{n_\Gamma}\to (-\infty, \infty]\) as follows</p>
<p class="formulaDsp">
\[ g(z) = \sum_{k=0}^{N-1} \bar\phi(z_k) + \bar\phi_N(z_N). \]
</p>
<p>Then, \(\mathbb{P}(p)\) can be written in the following form</p>
<p class="formulaDsp">
\[ \begin{align*} \mathbb{P}(p) : &amp;\min_{x} f(x) + g(z)\\ &amp;\Gamma x - z = 0 \end{align*} \]
</p>
<p>where \(\Gamma:\mathbb{R}^{n}\to\mathbb{R}^{n_\Gamma}\) is a linear operator which maps \(x\) to \(z=\Gamma x\) so that \(z_k = Fx_k + Gu_k\) for \(k=0,\ldots, N-1\) and \(z_N=F_N x_N\).</p>
<p>Note here that we will treat \(\Gamma\) as a <a class="el" href="class_linear_operator.html">linear operator </a> (and not as a matrix) for which can compute its value \(\Gamma(x)\) at a point \(x\) and the value of its <em>adjoint</em> \(\Gamma^*(x^*)\) at a point \(x^*\) using two algorithms \(\Phi_\Gamma\) and \(\Phi_{\Gamma^*}\) respectively.</p>
<p>If \(\Gamma\) were to be described using a matrix, then this would be</p>
<p class="formulaDsp">
\[ \begin{align} \Gamma = \begin{bmatrix} F &amp; G\\ &amp; &amp; F &amp; G\\ &amp;&amp;&amp;&amp; \ddots\\ &amp;&amp;&amp;&amp;&amp; F &amp; G\\ &amp;&amp;&amp;&amp;&amp;&amp;&amp; F_N \end{bmatrix}, \end{align} \]
</p>
<p>and its adjoint would be described by \(\Gamma^{\top}\).</p>
<div class="sec" id="opt-control-constraints">Imposition of constraints</div><p>Constraints, are they <em>hard</em> or <em>soft</em>, are encoded in the nonsmooth function \(g\) introduced previously.</p>
<p>In the former case, \(g\) encodes constraints of the following form:</p>
<p class="formulaDsp">
\[ \begin{align*} z_k &amp;\in \mathcal{Z}_k,\\ z_N &amp;\in \mathcal{Z}_N, \end{align*} \]
</p>
<p>these correspond to the constraints</p>
<p class="formulaDsp">
\[ \begin{align*} F x_k + G u_k &amp;\in \mathcal{Z}_k,\\ F_N x_N &amp;\in \mathcal{Z}_N. \end{align*} \]
</p>
<p>Sets \(\mathcal{Z}_k\) and \(\mathcal{Z}_N\) are such that we can easily compute their projection operator - that is, their proximal operator.</p>
<p>Without loss of generality we will assume that \(\mathcal{Z}_k=\{z_k: z_{\min} \leq z_k \leq z_{\max}\}\) and \(\mathcal{Z}_N = \{z_N: z_N\leq 1\}\).</p>
<p>Here is an example of how one can easily construct such a \(g\) in libForBES that corresponds to constraints of the form</p>
<p class="formulaDsp">
\[ \begin{align*} x_{\min} \leq x_k \leq &amp;x_{\max}\\ u_{\min} \leq u_k \leq &amp;u_{\max}\\ F_N x_N \leq &amp;1 \end{align*} \]
</p>
<div class="sec" id="nabla-f-algorithm">Algorithmic computation of \(f^*\) and \(\nabla f^*\)</div><p>The convex conjugate of \(f\) is, by definition, the function \(f^*:\mathbb{R}^n \to \mathbb{R}\) given by</p>
<p class="formulaDsp">
\[ \begin{align*} f^*(y) &amp;= \sup_{x} \{y^{\top}x - f(x)\}\notag\\ &amp;= -\inf_{x} \{f(x) - y^{\top}x \}=-\min_{x} \{f(x) - y^{\top}x \} \end{align*} \]
</p>
<p>Since \(f\) is assumed to be strictly convex, \(f^*\) is differentiable and its gradient is given by Theorem 23.5 in [1].</p>
<p class="formulaDsp">
\[ \begin{align*} \nabla f^*(y) &amp;= \mathrm{argmin}_{x} \{f(x) - y^{\top}x \}\\ &amp;= \mathrm{argmin}_{x\in \mathcal{S}(p)} \left\{ \sum_{k=0}^{N-1} \phi(x_k, u_k) + \phi_N(x_N) -y^{\top}x \right\}\\ &amp;= \mathrm{argmin}_{x\in \mathcal{S}(p)} \left\{ \sum_{k=0}^{N-1} \psi(x_k, u_k, y_k) + \psi_N(x_N,y_N) \right\}, \end{align*} \]
</p>
<p>where \(\psi(x_k, u_k, y_k) = \phi(x_k, u_k) - y_k^{\top}x_k\) and \(\psi_N(x_N, y_N) = \phi_N(x_N) -y_N^{\top}x_N\).</p>
<p>Notice that this problem is an equality-constrained optimization problem and has a structure that allows the use of DP recursion for its solution.</p>
<p>A <em>factor step</em> is performed once as shown in Algorithm 1 and the value of \(\nabla f^*(y; p)\) is returned by Algorithm 2.</p>
<p>Notice that neither in neither of these algorithms do we need to invert \(\bar{R}_k\); these matrices are symmetric positive definite and we can computed their <a class="el" href="class_cholesky_factorization.html">Cholesky factorization</a>.</p>
<p>Overall, both algorithms involve only matrix-vector products.</p>
<p>These algorithms have been adapted from [2] using \(F=-[I \ 0]^{\top}\), \(G=-[0\ I]^{\top}\) and \(F_N = -I\).</p>
<p>Algorithms 3 and 4 in [2] return the value of \(f^*(-\Gamma^{\top} y)\), so with the above choice of \(F\), \(G\) and \(F_N\), these algorithms return \(f^*(y)\).</p>
<p>We have</p>
<p class="formulaDsp">
\[ \begin{align*} C_k &amp;= \begin{bmatrix} -I &amp; -K^{\top} \end{bmatrix}\\ D_k &amp;= \begin{bmatrix} 0 \\ -\bar{R}_k^{-1} \end{bmatrix} \end{align*} \]
</p>
<div class="image">
<img src="Alg1.png" alt="Alg1.png"/>
</div>
<p>In Algorithm 1 notice that in case \(Q_N\) solves the matrix equation</p>
<p class="formulaDsp">
\[ Q_N = Q + A^{\top}Q_N A - (S+B^{\top}Q_N A)^{\top}(R+B^{\top}Q_N B)^{-1}(S+B^{\top} Q_N A), \]
</p>
<p>then \(\bar{R}_k\), \(\bar{S}_k\) and \(P_k\) and all other outputs of Algorithm 1 are independent of \(k\).</p>
<div class="image">
<img src="Alg2.png" alt="Alg2.png"/>
</div>
<p>In Algorithm 2, \(y_k^x\) stands for the part of the dual vector \(y_k\) which corresponds to the state vector \(x_k\), that is, the first \(n_x\) coordinates of \(y_k\), whereas \(y_k^u\) corresponds to \(u_k\), that is, it is the last \(m\) entries of \(y_k\).</p>
<div class="sec" id="refs">References</div><ol type="1">
<li>R. Rockafellar, Convex analysis. Princeton university press, 1972</li>
<li>P. Patrinos and A. Bemporad, "An accelerated dual gradient-projection algorithm for embedded linear model predictive control," IEEE Trans. Aut. Contr., vol. 59, no. 1, pp. 18–33, 2014. </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 11 2016 18:27:19 for LibForBES by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
