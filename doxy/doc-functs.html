<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LibForBES: Functions API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dox_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LibForBES
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">Solver for nonsmooth convex optimization problems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Functions API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Functions API</p>
<h1><a class="anchor" id="functions-api"></a>
Function API</h1>
<p>The ForBES function API allows end-users to define their own functions and at the same time provides a collection of functions that are frequently used and have applications in machine learning, control and other applications of optimization. A complete list of these functions can be found <a class="el" href="group___functions.html">here</a>.</p>
<p>Class <a class="el" href="class_function.html" title="A ForBES function. ">Function</a> has no public constructors, therefore, one cannot directly create function objects. Instances of this class are created using its subclasses, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> lambda = 1.0;</div>
<div class="line"><span class="keywordtype">double</span> mu = 0.8;</div>
<div class="line"><a class="code" href="class_function.html">Function</a> * elastic = <span class="keyword">new</span> <a class="code" href="class_elastic_net.html">ElasticNet</a>(lambda, mu);</div>
</div><!-- fragment --><p>The <a class="el" href="class_function.html" title="A ForBES function. ">Function</a> API contains the following methods which are implemented by subclasses of <a class="el" href="class_function.html" title="A ForBES function. ">Function</a>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> call (<a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> &amp;f); </div>
<div class="line"><span class="keywordtype">int</span> call (<a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> &amp;f, <a class="code" href="class_matrix.html">Matrix</a> &amp;grad);</div>
<div class="line"><span class="keywordtype">int</span> callConj (<span class="keyword">const</span> <a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> &amp;f_star);</div>
<div class="line"><span class="keywordtype">int</span> callConj (<span class="keyword">const</span> <a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> &amp;f_star, <a class="code" href="class_matrix.html">Matrix</a> &amp;grad);</div>
<div class="line"><span class="keywordtype">int</span> callProx (<span class="keyword">const</span> <a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> gamma, <a class="code" href="class_matrix.html">Matrix</a> &amp;prox);</div>
<div class="line"><span class="keywordtype">int</span> callProx (<span class="keyword">const</span> <a class="code" href="class_matrix.html">Matrix</a> &amp;x, <span class="keywordtype">double</span> gamma, <a class="code" href="class_matrix.html">Matrix</a> &amp;prox, <span class="keywordtype">double</span> &amp;f_at_prox);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Recall that the <em>convex conjugate</em> or <em>Fenchel conjugate</em> of a convex function is defined as <p class="formulaDsp">
\[ f^*(y) = \sup_{z\in\mathbb{R}^n} \langle z, y\rangle - f(z). \]
</p>
 and the proximal operator is defined as <p class="formulaDsp">
\[ \mathrm{prox}_{\gamma f}(v) = \mathrm{argmin}_x f(x) + \frac{1}{2\gamma}\|x-v\|^2 \]
</p>
</dd></dl>
<p>The methods of class Function may provide the following functionality:</p>
<ol type="1">
<li>Compute the value of the function \(f(x)\in\mathbb{R}\) for a given vector \(x\in\mathbb{R}^n\) or matrix \(x\in\mathbb{R}^{n\times m}\)</li>
<li>Compute the \(f(x)\) as well as its gradient \(\nabla f(x)\)</li>
<li>Compute the value of the conjugate of the function \(f^*(y)\) at a given point</li>
<li>Compute the value \(f^*(y)\) and the gradient \(\nabla f^*(y)\)</li>
<li>Compute the value of the proximal operator \(\mathrm{prox}_{\gamma f}(v)\)</li>
<li>Compute the proximal operator and the value of the function at the proximal point, that is \(f(\mathrm{prox}_{\gamma f}(v))\).</li>
<li>Compute inner products with the Hessian, i.e., \(\langle\nabla^2 f(x), z\rangle\),</li>
<li>Compute inner products with the Hessian of the conjugate function \(\langle\nabla^2 f^*(x), z\rangle\)</li>
</ol>
<p>Not all of the above methods are always implemented.</p>
<p>If a method is implemented and the computation succeeds it returns the status code <a class="el" href="class_for_b_e_s_utils.html#a3778b88ef7ec8a5024eec49a0d7a656d">STATUS_OK</a>.</p>
<p>If instead the method is not implemented, it will return a status code <a class="el" href="class_for_b_e_s_utils.html#a9c1e46ac1b8075a0971d2ce770ee10d9">STATUS_UNDEFINED_FUNCTION</a>.</p>
<p>If the method is implemented, but the computation fails, the method will return the code <a class="el" href="class_for_b_e_s_utils.html#a53fac59eee7ac0e49689d8c3b666b34f">STATUS_NUMERICAL_PROBLEMS</a>.</p>
<p>It is of course possible to know whether a particular method is implemented for a function using its <a class="el" href="class_function.html#a3a4d0cbc4596280ac32c2593dfd3b9be">category </a> which returns the <a class="el" href="class_function_ontological_class.html">ontological class</a> of a function; an object which contains meta information about the function. This is how to check whether a given Function object implements the method <code>call</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> lambda = 1.0;</div>
<div class="line"><span class="keywordtype">double</span> mu = 0.8;</div>
<div class="line"><span class="keywordtype">double</span> fx;</div>
<div class="line"><span class="keywordtype">double</span> xdata[2] = {2.0, 3.0};</div>
<div class="line"><a class="code" href="class_matrix.html">Matrix</a> x(2, 1, xdata);</div>
<div class="line"><a class="code" href="class_function.html">Function</a> * elastic = <span class="keyword">new</span> <a class="code" href="class_elastic_net.html">ElasticNet</a>(lambda, mu);</div>
<div class="line"><span class="keywordflow">if</span> (elastic-&gt;<a class="code" href="class_function.html#a3a4d0cbc4596280ac32c2593dfd3b9be">category</a>().<a class="code" href="class_function_ontological_class.html#a7abbe565fa85afeea5b25fd15d6f3bd3">defines_f</a>()) {</div>
<div class="line">  <span class="keywordtype">int</span> status = elastic -&gt; call(x, fx);</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="class_for_b_e_s_utils.html#a3778b88ef7ec8a5024eec49a0d7a656d">ForBESUtils::STATUS_OK</a> != status) {</div>
<div class="line">     <span class="comment">// something went wrong!</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="keyword">delete</span> elastic;</div>
</div><!-- fragment --><h1><a class="anchor" id="custom-function"></a>
Building custom functions</h1>
<p>Following the Function API explained above, one can easily implement their own functions by extending the abstract base class <a class="el" href="class_function.html" title="A ForBES function. ">Function</a>.</p>
<p>A custom function needs to extend the base class <a class="el" href="class_function.html" title="A ForBES function. ">Function</a> and implement one or more of its virtual methods <code>call</code>, <code>callConj</code> and <code>callProx</code>.</p>
<p>Additionally, the custom implementation should provide meta-information about the function such as its name and which components are actually implemented.</p>
<p>Implemented methods return either a <a class="el" href="class_for_b_e_s_utils.html#a3778b88ef7ec8a5024eec49a0d7a656d">success status code</a> or an <a class="el" href="class_for_b_e_s_utils.html#a53fac59eee7ac0e49689d8c3b666b34f">error code</a>, whereas methods which are not implemented will return a <a class="el" href="class_for_b_e_s_utils.html#a9c1e46ac1b8075a0971d2ce770ee10d9">undefined function</a> status.</p>
<p>We shall give here an example of how to implement \(f(x)=\sum_{i=1}^{n}x_i^4\) as a Function.</p>
<p>We first create a class called <code>Foo</code> in this example which extends <a class="el" href="class_function.html" title="A ForBES function. ">Function</a>:</p>
<div class="fragment"><div class="line"><span class="comment">/* File: Foo.h */</span></div>
<div class="line"><span class="keyword">class </span>Foo : <span class="keyword">public</span> <a class="code" href="class_function.html">Function</a> { </div>
<div class="line"><span class="keyword">public</span>:  </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_function.html#ab749ead2d6688a35e628dc7f38229b1e">call</a>(<a class="code" href="class_matrix.html">Matrix</a>&amp; x, <span class="keywordtype">double</span>&amp; f);</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_function.html#ab749ead2d6688a35e628dc7f38229b1e">call</a>(<a class="code" href="class_matrix.html">Matrix</a>&amp; x, <span class="keywordtype">double</span>&amp; f, <a class="code" href="class_matrix.html">Matrix</a>&amp; grad);</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_function_ontological_class.html">FunctionOntologicalClass</a> <a class="code" href="class_function.html#a3a4d0cbc4596280ac32c2593dfd3b9be">category</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>We first implement the method <a class="el" href="class_function.html#ab749ead2d6688a35e628dc7f38229b1e">call</a> which computes the value of \(f(x)\) at a given point.</p>
<div class="fragment"><div class="line"><span class="comment">/* File: Foo.cpp */</span></div>
<div class="line"><span class="keywordtype">int</span> Foo::call(<a class="code" href="class_matrix.html">Matrix</a>&amp; x, <span class="keywordtype">double</span>&amp; f) {</div>
<div class="line">    <span class="keywordflow">if</span> (!x.<a class="code" href="class_matrix.html#a863f25e7addbd2a92b48ed25a7223cfb">isColumnVector</a>()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;x must be a column-vector&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    f = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; x.<a class="code" href="class_matrix.html#ae1329328637e15c238ff88d8bd002a90">getNrows</a>(); i++){</div>
<div class="line">        f += std::pow(x.<a class="code" href="class_matrix.html#ade6530fe4f127ba13a7030b5e48e2859">get</a>(i,0),4);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="class_for_b_e_s_utils.html#a3778b88ef7ec8a5024eec49a0d7a656d">ForBESUtils::STATUS_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In a similar manner, we can now implement a method which returns the value of \(f(x)\) and the gradient \(\nabla f(x)\) as follows</p>
<div class="fragment"><div class="line"><span class="comment">/* File: Foo.cpp */</span></div>
<div class="line"><span class="keywordtype">int</span> Foo::call(<a class="code" href="class_matrix.html">Matrix</a>&amp; x, <span class="keywordtype">double</span>&amp; f, <a class="code" href="class_matrix.html">Matrix</a>&amp; grad) {</div>
<div class="line">    <span class="keywordflow">if</span> (!x.<a class="code" href="class_matrix.html#a863f25e7addbd2a92b48ed25a7223cfb">isColumnVector</a>()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;x must be a column-vector&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (x.<a class="code" href="class_matrix.html#ae1329328637e15c238ff88d8bd002a90">getNrows</a>() != grad.<a class="code" href="class_matrix.html#ae1329328637e15c238ff88d8bd002a90">getNrows</a>()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;x and grad must have the same number of rows&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    f = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; x.<a class="code" href="class_matrix.html#ae1329328637e15c238ff88d8bd002a90">getNrows</a>(); i++){</div>
<div class="line">        f += std::pow(x.<a class="code" href="class_matrix.html#ade6530fe4f127ba13a7030b5e48e2859">get</a>(i,0),4);</div>
<div class="line">        grad(i,0) = 4.0 * std::pow(x.<a class="code" href="class_matrix.html#ade6530fe4f127ba13a7030b5e48e2859">get</a>(i,0),3);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="class_for_b_e_s_utils.html#a3778b88ef7ec8a5024eec49a0d7a656d">ForBESUtils::STATUS_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, we need to implement method <a class="el" href="class_function.html#a3a4d0cbc4596280ac32c2593dfd3b9be">category </a> which provides meta-data for our implementation:</p>
<div class="fragment"><div class="line"><span class="comment">/* File: Foo.cpp */</span></div>
<div class="line"><a class="code" href="class_function_ontological_class.html">FunctionOntologicalClass</a> Foo::category() {</div>
<div class="line">    <a class="code" href="class_function_ontological_class.html">FunctionOntologicalClass</a> meta(<span class="stringliteral">&quot;FourthPower&quot;</span>);</div>
<div class="line">    meta.set_defines_f(<span class="keyword">true</span>);</div>
<div class="line">    meta.set_defines_grad(<span class="keyword">true</span>);</div>
<div class="line">    meta.add_superclass( <a class="code" href="class_function_ontology_registry.html#a7bd72f4107665765dd90f66886fd45d1">FunctionOntologyRegistry::function</a>() );</div>
<div class="line">    <span class="keywordflow">return</span> meta;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 11 2017 11:28:23 for LibForBES by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
